
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6. Lab 3: Actuating the turtlebot in simulation &#8212; COMP3631 Website</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=605502e1" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script src="_static/documentation_options.js?v=296c0a1b"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lab3';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Lab 4: Mapping and Navigation" href="lab4.html" />
    <link rel="prev" title="5. Lab 2: Writing a Talker and Listener" href="lab2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/comp3631-logo-large-title.png" class="logo__image only-light" alt="COMP3631 Website - Home"/>
    <script>document.write(`<img src="_static/comp3631-logo-large-title.png" class="logo__image only-dark" alt="COMP3631 Website - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    COMP3631 Lab Worksheets
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="teaching-assistants.html">1. Teaching/Lab Assistants</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">2. Frequently Asked Questions (FAQ) and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab1.html">3. Lab 1.1: Setting up your environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab1-optional.html">4. Lab 1.2: Learn about the command line interface and Git/GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">5. Lab 2: Writing a Talker and Listener</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Lab 3: Actuating the turtlebot in simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">7. Lab 4: Mapping and Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">8. Lab 5: Computer Vision: Processing robot’s camera view</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_the_real_robot.html">9. How to use the real-robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab6.html">10. Lab 6: Real-robot lab</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 3: Actuating the turtlebot in simulation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worksheet-objective">6.1. Worksheet Objective</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">6.2. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#start-gazebo">6.3. Start Gazebo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turtlebot-ros-nodes-and-topics">6.4. Turtlebot ROS nodes and topics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-velocity-topic">6.5. Understanding the velocity topic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-firstwalk-program-moving-forward-and-backwards">6.6. The firstwalk program: moving forward and backwards</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">6.7. Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks-and-checklist">6.8. Remarks and Checklist</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-3-actuating-the-turtlebot-in-simulation">
<h1><span class="section-number">6. </span>Lab 3: Actuating the turtlebot in simulation<a class="headerlink" href="#lab-3-actuating-the-turtlebot-in-simulation" title="Link to this heading">#</a></h1>
<!-- **Worksheet Contact:** Rafael Papallas (r.papallas@leeds.ac.uk) -->
<p><strong>Worksheet Contact:</strong> Xiao Wang (<a class="reference external" href="mailto:x&#46;wang16&#37;&#52;&#48;leeds&#46;ac&#46;uk">x<span>&#46;</span>wang16<span>&#64;</span>leeds<span>&#46;</span>ac<span>&#46;</span>uk</a>)</p>
<p>Please aim to complete this worksheet during week 4. The labs scheduled in week
4 will offer support and guidance for this worksheet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Access lab3 files - Instructions</strong></p>
<p>To access the lab3 files, you need to click on this url
<a class="reference external" href="https://classroom.github.com/a/1rqrBEz5">classroom.github.com/a/1rqrBEz5</a>,
login to your
GitHub account and click the button to accept the lab3 assignment.</p>
<p>As always, before you start running any commands or code for this worksheet,
make sure <a class="reference internal" href="lab1.html#singularity-command"><span class="std std-ref">you are in a Singularity environment</span></a>.</p>
<p>Then execute the following commands:</p>
<ul class="simple">
<li><p>In a terminal, go to <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/ros2_ws/src</span></code>.</p></li>
<li><p>Run: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:COMP3631/lab3-YOUR_GITHUB_USERNAME</span> <span class="pre">lab3</span></code></p>
<ul>
<li><p>Note the ” lab3” at the end of the the command: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">[...]</span> <span class="pre">lab3</span></code>.</p></li>
</ul>
</li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">$HOME/ros2_ws</span></code> and then <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> to build the new package.</p></li>
</ul>
</div>
<section id="worksheet-objective">
<h2><span class="section-number">6.1. </span>Worksheet Objective<a class="headerlink" href="#worksheet-objective" title="Link to this heading">#</a></h2>
<p>The objective of this worksheet is to help you understand how to control the
robot and how to use it in a simulator. You will expand upon the concepts
learned in lab 2 and implement the publishing-subscribing pattern to give
commands to the robot.</p>
</section>
<section id="prerequisites">
<h2><span class="section-number">6.2. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<p>Before you start working on this worksheet, make sure to do the following one-time
configuration:</p>
<ol class="arabic simple">
<li><p>Open a terminal window and navigate to your workspace’s source directory:
<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/ros2_ws/src</span></code>.</p></li>
<li><p>Git clone the following: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:COMP3631/turtlebot3_simulations.git</span></code> (make sure you have an
SSH key with GitHub as instructed in <a class="reference internal" href="lab1.html"><span class="std std-doc">lab 1</span></a>).</p></li>
<li><p>Navigate to your workspace and rebuild: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">~/ros2_ws</span> <span class="pre">&amp;&amp;</span> <span class="pre">colcon</span> <span class="pre">build</span></code>.</p></li>
<li><p>Remember to work in Code with the embedded terminals or run <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">~/.bashrc</span></code> in the current terminal.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You can safely ignore the following warning message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--- stderr: turtlebot3_gazebo
CMake Warning (dev) at /usr/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:438 (message):
  The package name passed to `find_package_handle_standard_args` (PkgConfig)
  does not match the name of the calling package (gazebo).  This can lead to
  problems in calling code that expects `find_package` result variables
  (e.g., `_FOUND`) to follow a certain pattern.
Call Stack (most recent call first):
  /usr/share/cmake-3.22/Modules/FindPkgConfig.cmake:99 (find_package_handle_standard_args)
  /usr/lib/x86_64-linux-gnu/cmake/gazebo/gazebo-config.cmake:72 (include)
  CMakeLists.txt:23 (find_package)
This warning is for project developers.  Use -Wno-dev to suppress it.
</pre></div>
</div>
<p>If you get any errors, however, try deleting <code class="docutils literal notranslate"><span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">build</span></code> directories
under <code class="docutils literal notranslate"><span class="pre">ros2_ws/</span></code> and run <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> again.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you encounter this error while launching turtlebot3_space.launch.py:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[gzclient-2] gzclient: /usr/include/boost/smart_ptr/shared_ptr.hpp:728: 
typename boost::detail::sp_member_access&lt;T&gt;::type boost::shared_ptr&lt;T&gt;::operator-&gt;() const [with T = gazebo::rendering::Camera; 
typename boost::detail::sp_member_access&lt;T&gt;::type = gazebo::rendering::Camera*]: Assertion `px != 0&#39; failed.

[ERROR] [gzclient-2]: process has died [pid 15429, exit code -6, cmd &#39;gzclient&#39;]. 
</pre></div>
</div>
<p>you can run this in the terminal: <code class="docutils literal notranslate"><span class="pre">.</span> <span class="pre">/usr/share/gazebo</span></code>
<br> then try to launch again.</p>
</div>
</section>
<section id="start-gazebo">
<h2><span class="section-number">6.3. </span>Start Gazebo<a class="headerlink" href="#start-gazebo" title="Link to this heading">#</a></h2>
<p>Gazebo is a simulator, making it an ideal platform for programming a
simulated turtlebot. Starting in simulation offers several advantages,
including convenience and safety for experimentation. After successfully
developing a functional demo in the simulated environment, we can confidently
deploy the software onto a physical robot.</p>
<p>Let’s start a Gazebo instance. Open a new singularity terminal window and run:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Gazebo may require a few minutes to launch the first time.
Gazebo will initiate a download process and generate new files on
your computer for the first time. Please wait until a new window displaying the
virtual environment with the robot is launched.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">launch</span> <span class="n">turtlebot3_gazebo</span> <span class="n">turtlebot3_space</span><span class="o">.</span><span class="n">launch</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will open the Gazebo simulator, allowing you to interact with the
Turtlebot and various objects within a simulated environment. To adjust your
view, use your mouse’s scroll wheel for zooming in and out. For rotation of
your perspective within the world, press and hold your mouse’s middle button
while moving the mouse. Additionally, you can experiment with the left and
right mouse buttons for further exploration of the three-dimensional
virtual environment and the robot.</p>
<p>At the top of your screen, you will see a menu, like the one below:</p>
<figure class="align-default" id="id1">
<img alt="_images/gazebo-menu.png" src="_images/gazebo-menu.png" />
<figcaption>
<p><span class="caption-text">Gazebo menu</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Currently, the leftmost pointer mode is selected. In this mode, your mouse
movement adjusts your view within the virtual world. Now, please select the
second mode from the left, which looks like a cross with arrows. In this mode,
you can click and hold on an object within the virtual world, allowing you to
drag and reposition it. This mode lets you move objects, including the robot,
as if they were any other item in the world.</p>
</section>
<section id="turtlebot-ros-nodes-and-topics">
<h2><span class="section-number">6.4. </span>Turtlebot ROS nodes and topics<a class="headerlink" href="#turtlebot-ros-nodes-and-topics" title="Link to this heading">#</a></h2>
<p>In the Gazebo environment, various ROS nodes run in the background, providing
fundamental functionalities for the Turtlebot. These include the controller for
the TurtleBot’s mobile base, drivers for its sensors, and more. If you wish to
view a list of all running ROS nodes, open a new terminal and
execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">node</span> <span class="nb">list</span>
</pre></div>
</div>
<p>and inspect the result. Many of the nodes are named to explain their
functionality, so try to guess what each one does. Similarly, to see all the
ROS topics that are advertised, do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">topic</span> <span class="nb">list</span>
</pre></div>
</div>
<p>These topics include all the essential components necessary for the
operation of the Turtlebot. Are you able to locate the one
labelled <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code>? As its name implies, this topic is used for sending
velocity commands to control the mobile base of the robot. It will be an
important topic in our activities today.</p>
</section>
<section id="understanding-the-velocity-topic">
<h2><span class="section-number">6.5. </span>Understanding the velocity topic<a class="headerlink" href="#understanding-the-velocity-topic" title="Link to this heading">#</a></h2>
<p>To see the publishers and subscribers to the topic, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">topic</span> <span class="n">info</span> <span class="o">/</span><span class="n">cmd_vel</span>
</pre></div>
</div>
<p>The subscriber of this topic controls the mobile base. To move the robot, we
will write a new node that will publish to this topic.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">info</span></code> command also shows us the type of the topic. It is
<code class="docutils literal notranslate"><span class="pre">geometry_msgs/msg/Twist</span></code>. If we want to publish to the topic, we need to use this
type. What is in a <code class="docutils literal notranslate"><span class="pre">geometry_msgs/msg/Twist</span></code> type? The command <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">interface</span> <span class="pre">show</span></code> is
useful for that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">interface</span> <span class="n">show</span> <span class="n">geometry_msgs</span><span class="o">/</span><span class="n">msg</span><span class="o">/</span><span class="n">Twist</span>
</pre></div>
</div>
<p>The result shows us that Twist is actually a type that contains two other types
in it, specifically the <code class="docutils literal notranslate"><span class="pre">Vector3</span></code> type. Each <code class="docutils literal notranslate"><span class="pre">Vector3</span></code> type includes three float
values. Notice that one of the <code class="docutils literal notranslate"><span class="pre">Vector3</span></code> types are named <code class="docutils literal notranslate"><span class="pre">linear</span></code> and the other
<code class="docutils literal notranslate"><span class="pre">angular</span></code>. It is becoming more clear now: This is a message type to specify
linear and angular velocities in three dimensions.</p>
</section>
<section id="the-firstwalk-program-moving-forward-and-backwards">
<h2><span class="section-number">6.6. </span>The firstwalk program: moving forward and backwards<a class="headerlink" href="#the-firstwalk-program-moving-forward-and-backwards" title="Link to this heading">#</a></h2>
<p>You will find the file <code class="docutils literal notranslate"><span class="pre">firstwalk.py</span></code> in <code class="docutils literal notranslate"><span class="pre">lab3</span></code> directory. This program
moves the robot back and forth in an infinite loop.
While Gazebo is running, run this script in a separate terminal window,
and see what happens:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">run</span> <span class="n">lab3</span> <span class="n">firstwalk</span>
</pre></div>
</div>
<p>Now stop it by pressing: <code class="docutils literal notranslate"><span class="pre">CTRL+C</span></code>. Let’s study the code together as there are
multiple things going on to get this simple program working!</p>
<p>Please open the <code class="docutils literal notranslate"><span class="pre">firstwalk.py</span></code> file and read the following explanation. This
will help you understand how the program works.</p>
<div class="docutils">
<h4 class="rubric" id="importing-important-modules">Importing important modules</h4>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="linenos">2</span><span class="kn">from</span> <span class="nn">rclpy.exceptions</span> <span class="kn">import</span> <span class="n">ROSInterruptException</span>
<span class="linenos">3</span><span class="kn">import</span> <span class="nn">signal</span>
</pre></div>
</div>
<p>Note that we import few new things:</p>
<ol class="arabic simple">
<li><p><strong>Line 1:</strong> Since we need to publish to <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code> which expects a <code class="docutils literal notranslate"><span class="pre">Twist</span></code> message, we
need to import that message type.</p></li>
<li><p><strong>Line 2-3:</strong> We need to respond to a ROS interrupt exception to ensure the
robot stops moving. When a command is sent to the robot, if the program
unexpectedly terminates (e.g., due to being killed), the robot may continue
moving. Therefore, it is essential to catch and handle these exceptions to
ensure the robot stops moving.</p></li>
</ol>
<div class="docutils">
<h4 class="rubric" id="creating-the-publisher">Creating the publisher</h4>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="bp">self</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">Twist</span><span class="p">,</span> <span class="s1">&#39;/cmd_vel&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="linenos">2</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10 Hz</span>
</pre></div>
</div>
<p>The above lines appear in <code class="docutils literal notranslate"><span class="pre">__init__</span></code>:</p>
<ol class="arabic simple">
<li><p><strong>Line 1:</strong> we create a publisher to publish velocities to <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code>, note the
new type, <code class="docutils literal notranslate"><span class="pre">Twist</span></code>.</p></li>
<li><p><strong>Line 2:</strong> we create a rate object at 10 Hz to help us send velocities at the
specified frequency.</p></li>
</ol>
<div class="docutils">
<h4 class="rubric" id="the-walking-forward-and-backward-methods">The walking forward and backward methods</h4>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">walk_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="n">desired_velocity</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
<span class="linenos">3</span>    <span class="n">desired_velocity</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># Forward with 0.2 m/s</span>
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
<span class="linenos">6</span>        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">desired_velocity</span><span class="p">)</span>
<span class="linenos">7</span>        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
</pre></div>
</div>
<p>Now the interesting part, the <code class="docutils literal notranslate"><span class="pre">walk_forward</span></code> and <code class="docutils literal notranslate"><span class="pre">walk_backward</span></code> methods which
moves the robot forward and backward:</p>
<ol class="arabic simple">
<li><p><strong>Line 2:</strong> we create a <code class="docutils literal notranslate"><span class="pre">Twist</span></code> object. This object represents Twist
messages, which define velocities. It is initialised with empty velocities,
meaning both linear and angular velocities are set to zero.</p></li>
<li><p><strong>Line 3:</strong> we specify that the linear <span class="math notranslate nohighlight">\(x\)</span> velocity is <code class="docutils literal notranslate"><span class="pre">0.2</span></code>, which is in meters
per second (i.e., the robot will move at 20 cm per second). Note, as you
would expect, these velocities are not instantaneously achieved and
they are accelerated up to.</p></li>
<li><p><strong>Line 5:</strong> we create a for loop that executes 30 times.</p></li>
<li><p><strong>Line 6-7:</strong> we publish the Twist message and then sleep using
the rate object. The rate object maintains a constant loop rate of 10 Hz.
With 30 iterations, the loop will execute and publish velocities to the
robot for a total of 3 seconds.</p></li>
<li><p>The same idea applies for <code class="docutils literal notranslate"><span class="pre">move_backward</span></code> but we use <code class="docutils literal notranslate"><span class="pre">-0.2</span></code> linear <span class="math notranslate nohighlight">\(x\)</span>
velocity instead.</p></li>
</ol>
<div class="docutils">
<h4 class="rubric" id="the-stop-method">The stop method</h4>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="n">desired_velocity</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
<span class="linenos">3</span>    <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">desired_velocity</span><span class="p">)</span>
</pre></div>
</div>
<p>Nothing special happens here. The robot might continue moving even if we
stop publishing Twist messages. To guarantee the robot’s halt, we send a single
Twist message with zero velocities. Note that a new <code class="docutils literal notranslate"><span class="pre">Twist</span></code> object will initialise
with zero velocities, so we don’t have to explicitly set velocities to zero.</p>
<div class="docutils">
<h4 class="rubric" id="main-explained-infinite-loops-in-ros-and-how-to-handle-interruptions">Main explained: infinite loops in ROS and how to handle interruptions</h4>
</div>
<p>Please note that the main function has some additional complexity this time. We
will only explain new concepts introduced here. For previously covered topics,
please refer back to previous labs. In this program, we continuously move the
robot forward and backward within an ‘infinite’ loop. We need to implement a
robust mechanism for handling keyboard interruptions. The following sections
refer to code in the <code class="docutils literal notranslate"><span class="pre">main</span></code> function.</p>
<div class="docutils">
<h6 class="rubric" id="main-signal-catching">Main: Signal catching</h6>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="n">first_walker</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">3</span>    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="c1"># ...</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>In the code snippet above, we define a function that gets invoked when the user
presses <code class="docutils literal notranslate"><span class="pre">CTRL+C</span></code> on UNIX-like systems, signalling an interrupt to the process.
This function ensures that the robot will stop moving after our code has been
terminated, by sending zero velocities and then explicitly triggering the
shutdown method of the ROS API.</p>
<div class="docutils">
<h6 class="rubric" id="main-running-spin-in-a-thread">Main: Running spin in a thread</h6>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">first_walker</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>The code above starts the <code class="docutils literal notranslate"><span class="pre">rclpy.spin(first_walker)</span></code> in a separate thread.
This allows ROS to start communications while enabling us to execute other
commands concurrently. By running it in a thread, we ensure that it runs
asynchronously, preventing it from blocking the main program flow.</p>
<div class="docutils">
<h6 class="rubric" id="main-infinite-loops-in-ros">Main: Infinite loops in ROS</h6>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">2</span>    <span class="k">while</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">():</span>
<span class="linenos">3</span>        <span class="n">first_walker</span><span class="o">.</span><span class="n">walk_forward</span><span class="p">()</span>
<span class="linenos">4</span>        <span class="n">first_walker</span><span class="o">.</span><span class="n">walk_backward</span><span class="p">()</span>
<span class="linenos">5</span><span class="k">except</span> <span class="n">ROSInterruptException</span><span class="p">:</span>
<span class="linenos">6</span>    <span class="k">pass</span>
</pre></div>
</div>
<p>Finally, the code above shows the correct approach to running infinite
loops in ROS. We utilise <code class="docutils literal notranslate"><span class="pre">rclpy.ok()</span></code> to check if ROS is actively running
before executing our ROS commands, such as <code class="docutils literal notranslate"><span class="pre">walk_forward</span></code> and <code class="docutils literal notranslate"><span class="pre">walk_backward</span></code>.</p>
</section>
<section id="exercises">
<h2><span class="section-number">6.7. </span>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>The turtlebot is capable of moving forward, backward, turning left and right. However,
it cannot go sideways. In mobile robots, its type is called the differential drive robot.
In robotic motion planning, this means there are non-holonomical constraints to its motion.
This is basically a fancy way of saying it cannot go sideways. But it also means the robot
needs to turn itself before going ahead in a specific direction. And if turning and moving
forward/backward (relative to the robot’s body frame) happens at the same time, e.g. doing a
donut without drifting, its velocity is tangent to the donut at any instance. Similar to a car,
the robot is free to go anywhere on a 2D plane. But to park into the bay, you have to do a bit
of manoeuvre.</p>
<p>In this excercise, you will be sending the velocity commands to the turtlebot to make it move around.
It would be helpful if you can at least understand a bit of rigidbody motion, such as a twist.
Hopefully, when you type the numbers in, the robot’s motion matches your intuition! So let me try to
explain it here:</p>
<p>First of all, it is a vector <span class="math notranslate nohighlight">\(\mathcal{V} = [\boldsymbol{\mathcal{v}} \;\; \boldsymbol{\omega}]^T = [v_x \;\; v_y \;\; v_z \;\; w_x \;\; w_y \;\; w_z]^T \in \mathbf{R}^6\)</span>, that lumps together angular and linear velocity. It describes the
instantaneous motion of a rigid body. It is needed to have a reference frame when talking about motion.
The <code class="docutils literal notranslate"><span class="pre">Twist</span></code> in this case is <em><strong>relative to (expressed in) the robots body frame</strong></em> <span class="math notranslate nohighlight">\(\boldsymbol{\{b\}}\)</span>,
as illustrated:</p>
<figure class="align-default" id="turtlebot-body-frame">
<a class="reference internal image-reference" href="_images/body_frame_convention.jpg"><img alt="robot body frame" src="_images/body_frame_convention.jpg" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Illustration for turtlebot body frame, located at the mid point of the wheel axial.</span><a class="headerlink" href="#turtlebot-body-frame" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>If you are not familiar with mechanics, just remember the body frame is attached to the robot body and
goes with it. The choice of a reference frame is arbitrary in general, but the right choice simplifies
the problem dramatically. In this case, we choose the frame as illustrated. Not only does this conform
to the message type in <code class="docutils literal notranslate"><span class="pre">turtlebot3_simulations</span></code> package, but also to make the calculation simpler. This
is because the <span class="math notranslate nohighlight">\(\hat{x}_b\)</span> aligns with the direction of motion (or the velocity of the robot) at any
time instance. To give you some intuition, imagine the robot is moving forward, its velocity is just
pointing forward; if to be expressed in <span class="math notranslate nohighlight">\(\{b\}\)</span>, it aligns with <span class="math notranslate nohighlight">\(\hat{x}_b\)</span>. If the turtlebot is doing
a donut, at any instance, its velocity is tangent to the donut, then again aligns with <span class="math notranslate nohighlight">\(\hat{x}_b\)</span> if
to be expressed in this frame.</p>
<p>For the turtlebot, the configuration space is only 3d since it is just a planar system, i.e.
<span class="math notranslate nohighlight">\(\mathcal{C} = [x \;\; y \;\; \theta]^T \in \mathbf{R}^3\)</span> with respect to the world frame <span class="math notranslate nohighlight">\(\{w\}\)</span>.
However, the dimension of the velocity you can command is only <span class="math notranslate nohighlight">\(\mathbf{R}^2\)</span> because of the
non-holonomic constraints (If you are math-hard, go check out Pfaffian constraints in motion planning).
Therefore, you can only command <span class="math notranslate nohighlight">\([\dot{x} \;\; \dot{\theta}]^T = [v_x \;\; \omega_z]^T\)</span> in the body frame
<span class="math notranslate nohighlight">\(\{b\}\)</span>, which corresponds to moving along <span class="math notranslate nohighlight">\(\hat{x}_b\)</span> and rotating around <span class="math notranslate nohighlight">\(\hat{z}_b\)</span> axis. <span class="math notranslate nohighlight">\(v_y = 0\)</span>
is just not being able to go sideways. Without loosing generality, the <code class="docutils literal notranslate"><span class="pre">Twist</span></code> in ROS2 is 6D. When you
are sending the twist commands, you should only send to <span class="math notranslate nohighlight">\(\omega_z\)</span>, <span class="math notranslate nohighlight">\(v_x\)</span>. The other components are all
zeros by default. You can publish to the other components but makes no effects.</p>
<p>Now, to bridge your intuition to the physical concept of a twist, let’s separate linear and angular
components first. Setting <span class="math notranslate nohighlight">\(\omega_z\)</span> to a +/- value will make it spin along <span class="math notranslate nohighlight">\(\hat{z}\)</span> in place clockwise/
counter-clockwise (right-hand rule); setting <span class="math notranslate nohighlight">\(v_x\)</span> to +/- value, it will move forward and backward. These
are easy to understand. But what if I set <span class="math notranslate nohighlight">\(v_x = 0.2\)</span> and <span class="math notranslate nohighlight">\(\omega_z = 0.2\)</span> at the same time? I bet your
mind tells you that it will trace a circle. Now I ask: based on these two numbers, do you know how big
the circle is?</p>
<p>Before I show you the calculation. I would like you to bury this notion in mind: the axis of rotation can
be moved around as long as it is parallel to <span class="math notranslate nohighlight">\(\hat{z}_b\)</span>. When setting both angular and linear components,
we are really asking for this: where should we put the axis of rotation in <span class="math notranslate nohighlight">\(\{b\}\)</span>, and rotate around it at
<span class="math notranslate nohighlight">\(\omega_z = 0.2\)</span>, such that <span class="math notranslate nohighlight">\(v_x = 0.2\)</span> in <span class="math notranslate nohighlight">\(\{b\}\)</span>? To know the radius of the rotation, we only need a
simple equation: <span class="math notranslate nohighlight">\(\mathcal{v} = \omega \times r\)</span>, with <span class="math notranslate nohighlight">\(\times\)</span> being a cross-product. In our case,
<span class="math notranslate nohighlight">\(v = \omega \times \vec{PO}\)</span>, where <span class="math notranslate nohighlight">\(\vec{PO}\)</span> is directed from where the axis of rotation is in the <span class="math notranslate nohighlight">\(x-y\)</span>
plane to the origin of <span class="math notranslate nohighlight">\(\{b\}\)</span>. This is illustrated in the following figure:</p>
<figure class="align-default" id="twist-calculation">
<a class="reference internal image-reference" href="_images/twist.jpg"><img alt="twist" src="_images/twist.jpg" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Illustration for a twist calculation.</span><a class="headerlink" href="#twist-calculation" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The white dashed line is where the axis of rotation can be (Why is this? Diff drive can only go forward
i.e. <span class="math notranslate nohighlight">\(\hat{x}_b\)</span> with our choice of assigned body frame). The orange dot is the axis of rotation directed
out of the screen (same as <span class="math notranslate nohighlight">\(\hat{z}_b\)</span>). Then if you apply right-hand rule (imagine trying to grab the axis of
rotation with your right hand, and with your thumb pointing out of the screen), the direction of the curl of your
palm is the positive angular velocity (<span class="math notranslate nohighlight">\(+\omega\)</span>) by convention. Then imagine you have a disk with its centre
overlaps the orange axis of rotation and just as big to have its rim overlapping point <span class="math notranslate nohighlight">\(O\)</span>. If it is spinning
at <span class="math notranslate nohighlight">\(\omega_z\)</span>, at any instance, what is the velocity of a point on the rim that currently overlaps point <span class="math notranslate nohighlight">\(O\)</span>?<br />
The answer is: <span class="math notranslate nohighlight">\(v = \omega \times \vec{PO}\)</span>, which points along <span class="math notranslate nohighlight">\(+/-\hat{x}_b\)</span> depending on the sign of
your <span class="math notranslate nohighlight">\(\omega_z\)</span>. Now we have all the elements to command a twist as you wish. Here is the math:</p>
<ol class="arabic simple">
<li><p>Let’s say the axis of rotation is located at <span class="math notranslate nohighlight">\([0, y, 0]\)</span>, which is the orange dot expressed in <span class="math notranslate nohighlight">\(\{b\}\)</span>.</p></li>
<li><p>Let’s express <span class="math notranslate nohighlight">\(\vec{PO}\)</span> in body frame <span class="math notranslate nohighlight">\(\vec{PO} = [0 \;\; -y \;\; 0]^T\)</span></p></li>
<li><p>We know <span class="math notranslate nohighlight">\(\omega = [0 \;\; 0 \;\; \omega_z]^T = [0 \;\; 0 \;\; 0.2]^T\)</span></p></li>
<li><p>We know <span class="math notranslate nohighlight">\(v\)</span> already: <span class="math notranslate nohighlight">\(\mathcal{v} = [v_x \;\; v_y \;\; v_z]^T = [0.2 \;\; 0 \;\; 0]^T\)</span></p></li>
<li><p>Apply the expression: <span class="math notranslate nohighlight">\(v = \omega \times \vec{PO}\)</span>, then you have <span class="math notranslate nohighlight">\([0.2 \;\; 0 \;\; 0]^T = [0 \;\; 0 \;\; 0.2]^T \times [0 \;\; -y \;\; 0]^T\)</span></p></li>
<li><p>Expand the cross product on the right hand side, and evaluate to obtain the only unknow <span class="math notranslate nohighlight">\(y = +1.0\)</span> ,
which is the radius of the traced circle.</p></li>
</ol>
<p>So in this example, with you commanding <span class="math notranslate nohighlight">\(v_x = 0.2\)</span> and <span class="math notranslate nohighlight">\(\omega_z = 0.2\)</span>, the robot will trace a circle with a
centre always located to the left (<span class="math notranslate nohighlight">\(+\hat{y}_b\)</span>) of the robot at a distance of 1.0m. If you keep <span class="math notranslate nohighlight">\(v_x\)</span> the same
but increase <span class="math notranslate nohighlight">\(\omega_z\)</span>, it will trace a smaller circle but faster. Now for a reflection, think again what is a twist?
As we said, it describes the instantaneous motion of a rigid body. In this case, specifically the motion refers
to whether the robot is moving straight or turning. If we have two cases, such that one robot moves at
<span class="math notranslate nohighlight">\(\mathcal{V} = [0.2 \;\; 0 \;\; 0 \;\; 0 \;\; 0 \;\; 0]^T\)</span> and the other at <span class="math notranslate nohighlight">\(\mathcal{V} = [0.2 \;\; 0 \;\; 0 \;\; 0 \;\; 0 \;\; 0.2]^T\)</span>.
At any instance, the robot are moving forward in <span class="math notranslate nohighlight">\(\hat{x}_b\)</span> direction in the body frame at the same speed.
But the latter tells you that it is turning while the former is just going straight ahead. In fact, any rigid
body motion can be expressed as rotating about an axis located somewhere; if there is only linear velocity, the
axis of rotation is just located at infinity! To be more general intuition: try imagine kicking a football
with a body frame welded at its centre of mass, the ball (so does its body frame) moving forward in a curve
(without considering the ball’s spinning); along its trajectory at any point in time, there is an associated axis
of rotation located somewhere. This axis of rotation is changing with respect to time in the Catesian space, with
which there is an associated twist to describe its instantaneous motion! Whereas in our case with turtlebot, the
axis of rotation stays constant because we are commanding a constant twist. If our command is governed by a
differential equation, then our robot will be rotating around a changing axis over time! Furthermore, if we are
interested in a motion of a point located on the surface of the football, we need to take its spinning into account.
There is a recursive pattern to the compounded motion if you have a chain of frames to consider. Search for exponential
coordinates of rigid body motion for a manipulator if you want to know more!</p>
<p>Finally, the hardware enforces limits on the turtlebots velocities: <span class="math notranslate nohighlight">\(v_{x-max} = 0.22\;m/s\)</span> and <span class="math notranslate nohighlight">\(\omega_{z-max} = 2.84\;rad/s\)</span>.
Now you can fiddle with how big of a circle and how fast you can trace!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After creating the new scripts for each exercise below, remember to update the
<code class="docutils literal notranslate"><span class="pre">lab3/setup.py</span></code> file by adding a line for each new script. To ensure ROS
recognises your new Python files, execute <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> within your workspace
after updating the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>For the two excercise, if you do not stop it after doing the circle or square, it will continue doing it
in the <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">loop</span></code> in <code class="docutils literal notranslate"><span class="pre">main()</span></code>. If you want to do a complete cirle and stop, the limit in the <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">loop</span></code> matters,
which together with the command frequency controls how long it will move at the <code class="docutils literal notranslate"><span class="pre">Twist</span></code> you set. This would also
be useful for making a square, e.g. controlling the angle and edge length of the square.</p>
</div>
<div class="docutils">
<h3 class="rubric" id="exercise-1-drive-the-robot-in-a-circle">Exercise 1: Drive the robot in a circle</h3>
</div>
<p>Create a script named <code class="docutils literal notranslate"><span class="pre">exercise1.py</span></code> within the <code class="docutils literal notranslate"><span class="pre">ros2_ws/src/lab3/lab3</span></code>
directory to continuously drive the robot in a circular path. Utilise a loop to
consistently publish a single Twist message, which combines both angular and
linear velocities to achieve a smooth and well-defined circular motion. Don’t
forget to update <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> (see note box above).</p>
<p>You can test your solution after running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">run</span> <span class="n">lab3</span> <span class="n">YOUR_TARGET_NAME</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">YOUR_TARGET_NAME</span></code> is the name you assigned to the script in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<div class="docutils">
<h3 class="rubric" id="exercise-2-trace-a-square">Exercise 2: Trace a square</h3>
</div>
<p>Create a script named <code class="docutils literal notranslate"><span class="pre">exercise2.py</span></code> within the
<code class="docutils literal notranslate"><span class="pre">ros2_ws/src/lab3/lab3</span></code> directory to get the robot in tracing a square.
Keep in mind that the angular velocity is measured in radians per second, with
positive values indicating anti-clockwise movement. Consider this when
programming the turns to achieve a well-defined square shape.
Don’t forget to update <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> (see note box above)</p>
<p>You can test your solution after running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">run</span> <span class="n">lab3</span> <span class="n">YOUR_TARGET_NAME</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">YOUR_TARGET_NAME</span></code> is the name you assigned to the script in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
</section>
<section id="remarks-and-checklist">
<h2><span class="section-number">6.8. </span>Remarks and Checklist<a class="headerlink" href="#remarks-and-checklist" title="Link to this heading">#</a></h2>
<p>This worksheet covers various key aspects. Initially, you were introduced to
the Gazebo simulator. You explored the
<code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code> topic for publishing a <code class="docutils literal notranslate"><span class="pre">Twist</span></code> to control the robot. You gained the
knowledge of some rigidbody motion, enabling you to accomplish both circular movements
and square tracing.</p>
<p>Please check, by the end of this worksheet, that …</p>
<ul class="simple">
<li><p>You understand how to use the Gazebo simulator.</p></li>
<li><p>You can see a realistic world in Gazebo with the TurtleBot in it.</p></li>
<li><p>You understand how to move the robot.</p></li>
<li><p>You completed successfully the two exercises (move on a circle and move on a square).</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Lab 2: Writing a Talker and Listener</p>
      </div>
    </a>
    <a class="right-next"
       href="lab4.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Lab 4: Mapping and Navigation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worksheet-objective">6.1. Worksheet Objective</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">6.2. Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#start-gazebo">6.3. Start Gazebo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turtlebot-ros-nodes-and-topics">6.4. Turtlebot ROS nodes and topics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-velocity-topic">6.5. Understanding the velocity topic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-firstwalk-program-moving-forward-and-backwards">6.6. The firstwalk program: moving forward and backwards</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">6.7. Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks-and-checklist">6.8. Remarks and Checklist</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Rafael Papallas, Andy Bulpitt and Duygu Sarikaya
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Rafael Papallas, Andy Bulpitt and Duygu Sarikaya.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>